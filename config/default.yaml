# Neural Field Super-Resolution - Configuration
# ==============================================
# Surface-only model for 2 HRES variables (2t, msl).

seed_everything: 13

# Model configuration (decoder-only)
model:
  class_path: src.model.NeuralFieldSuperResModule
  init_args:
    # Architecture
    num_output_features: 2              # 2t and msl
    coord_dim: 2                        # 2D: lat, lon
    num_hidden_features: 512
    num_heads: 8
    
    # Processor
    use_self_attention: false
    num_processor_layers: 1
    
    # Decoder
    decoder_type: knn_cross
    num_decoder_layers: 2
    
    # Position encoding
    use_rope: false
    
    # Auxiliary features (z, lsm, slt)
    num_auxiliary_features: 0           # 0 = disabled, 3 = enabled
    
    # Optimizer
    learning_rate: 1.0e-4
    weight_decay: 0.01
    
    # Scheduler
    use_scheduler: true
    scheduler_t_max: null
    scheduler_eta_min: 1.0e-6
    
    # Loss
    loss_type: mse

# Data configuration
data:
  class_path: src.data.NeuralFieldDataModule
  init_args:
    # Paths
    latent_zarr_path: /projects/prjs1858/latents_europe_2018_2020.zarr
    # Full dataset (use when HRES download is complete):
    # hres_zarr_path: /projects/prjs1858/hres_europe_2018_2020.zarr
    # Current partial data (Jan-Jun 2018):
    hres_zarr_path: /projects/prjs1858/hres_europe_2018.zarr
    
    # Surface variables
    variables:
      - "2t"                            # 2m temperature
      - "msl"                           # Mean sea level pressure
    
    # Query sampling
    num_query_samples: null             # null = all points
    
    # Train/val split
    val_months: 1                       # Reduced for partial data
    # val_months: 3                     # Use 3 months for full dataset
    
    # DataLoader
    batch_size: 4
    num_workers: 4
    pin_memory: true
    normalize_coords: true
    
    # Auxiliary features (optional)
    # Europe-sliced static (create when needed):
    # static_zarr_path: /projects/prjs1858/static_hres_europe.zarr
    # Global static (available now):
    static_zarr_path: /projects/prjs1858/static_hres.zarr
    static_variables: ["z", "lsm", "slt"]
    use_static_features: false

# Trainer configuration
trainer:
  accelerator: auto
  devices: auto
  precision: 16-mixed
  max_epochs: 100
  gradient_clip_val: 1.0
  log_every_n_steps: 10
  check_val_every_n_epoch: 1
  
  callbacks:
    - class_path: pytorch_lightning.callbacks.ModelCheckpoint
      init_args:
        dirpath: checkpoints/
        filename: "epoch={epoch:03d}-val_loss={val/loss:.4f}"
        monitor: val/loss
        mode: min
        save_top_k: 1
        save_last: true
        auto_insert_metric_name: false
    
    - class_path: pytorch_lightning.callbacks.EarlyStopping
      init_args:
        monitor: val/loss
        patience: 20
        mode: min
        verbose: true
    
    - class_path: pytorch_lightning.callbacks.LearningRateMonitor
      init_args:
        logging_interval: epoch

  logger:
    class_path: pytorch_lightning.loggers.WandbLogger
    init_args:
      project: neural-field-superres
      name: europe-surface-2vars
      save_dir: logs/
      log_model: false
      tags: [europe, surface, 2t, msl]
